<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F0F2F5;
            color: #0F0F0F;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden;
        }

        /* --- Aurora Background --- */
        .aurora-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #F0F2F5; z-index: -1;
        }
        .aurora-background::before, .aurora-background::after {
            content: ''; position: absolute; filter: blur(100px); opacity: 0.3;
        }
        .aurora-background::before {
            background: radial-gradient(circle, #ff8a00, transparent 60%);
            width: 400px; height: 400px; top: -100px; left: -150px;
            animation: move-aurora-1 15s infinite alternate;
        }
        .aurora-background::after {
            background: radial-gradient(circle, #e60000, transparent 60%);
            width: 500px; height: 500px; bottom: -150px; right: -200px;
            animation: move-aurora-2 12s infinite alternate;
        }
        @keyframes move-aurora-1 { to { transform: translate(100px, 50px); } }
        @keyframes move-aurora-2 { to { transform: translate(-80px, -40px); } }

        /* --- Card Styling --- */
        .card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.03), 0 2px 4px -2px rgba(0,0,0,0.03);
        }
        
        /* --- Animations & Transitions --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-card { opacity: 0; animation: fadeIn 0.5s ease-out forwards; }
        .transition-all-fast { transition: all 0.2s ease-in-out; }
        #sidebar-overlay { background-color: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease-in-out; pointer-events: none; }
        #sidebar-overlay.open { opacity: 1; pointer-events: auto; }

        /* --- BRANDED Sidebar Enhancements --- */
        .sidebar { background-color: #0F0F0F; }
        .sidebar-item { position: relative; }
        .sidebar-item > a, .sidebar-item > button { color: #9CA3AF; font-weight: 500; }
        .sidebar-item:hover > a, .sidebar-item:hover > button { color: #FFFFFF; background-color: #1F2937; }
        .parent-active > button { color: #FFFFFF; }
        .parent-active { position: relative; }
        .parent-active::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
            background: #e60000; border-top-right-radius: 4px; border-bottom-right-radius: 4px;
        }
        .nav-link.sub-active { color: #FFFFFF; font-weight: 600; background-color: #374151; }
        .sidebar-submenu-container { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s ease-in-out; }
        .sidebar-submenu-container.open { grid-template-rows: 1fr; }
        .sidebar-submenu { overflow: hidden; }
        
        /* --- Custom Scrollbar --- */
        main::-webkit-scrollbar, .sidebar-scroll::-webkit-scrollbar { width: 6px; }
        main::-webkit-scrollbar-track, .sidebar-scroll::-webkit-scrollbar-track { background: transparent; }
        main::-webkit-scrollbar-thumb, .sidebar-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }
        main::-webkit-scrollbar-thumb:hover, .sidebar-scroll::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.3); }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #374151; }
        .sidebar-scroll::-webkit-scrollbar-thumb:hover { background: #4B5563; }

        /* --- Brand Color Utilities --- */
        .text-brand-red { color: #e60000; }
        .bg-brand-red { background-color: #e60000; }
        .ring-brand-red { --tw-ring-color: #e60000; }
        .text-brand-black { color: #0F0F0F; }
        
        .profile-card-bg {
             background-image: radial-gradient(#0F0F0F 0.5px, transparent 0.5px), radial-gradient(#0F0F0F 0.5px, #FFFFFF 0.5px);
             background-size: 20px 20px;
             background-position: 0 0, 10px 10px;
             opacity: 0.05;
        }
        
        /* --- Toggle Switch --- */
        .toggle-bg:after {
            content: '';
            @apply absolute top-0.5 left-0.5 bg-white border border-gray-300 rounded-full h-5 w-5 transition shadow-sm;
        }
        input:checked + .toggle-bg:after {
            transform: translateX(100%);
            @apply border-white;
        }
        input:checked + .toggle-bg {
            @apply bg-brand-red;
        }
    </style>
</head>
<body class="text-brand-black">
    <div class="aurora-background"></div>

    <div class="flex h-screen">
        <div id="sidebar-overlay" class="fixed inset-0 z-30 md:hidden"></div>

        <nav id="sidebar" class="w-64 sidebar text-gray-300 flex-shrink-0 flex flex-col fixed inset-y-0 left-0 z-40 -translate-x-full md:relative md:translate-x-0">
            <div class="h-24 flex items-center justify-between px-6">
                <div class="flex items-center">
                    <svg width="32" height="32" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-brand-red">
                        <path d="M32 0C14.327 0 0 14.327 0 32C0 49.673 14.327 64 32 64C49.673 64 64 49.673 64 32C64 14.327 49.673 0 32 0ZM45.623 48H39.131L32.016 31.819L24.869 48H18.377L28.623 27.557V16H35.377V27.557L45.623 48Z" fill="currentColor"/>
                    </svg>
                    <h1 class="text-xl font-bold text-white ml-3">WFM</h1>
                </div>
                <button id="close-sidebar-btn" class="p-2 md:hidden"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="flex-grow overflow-y-auto sidebar-scroll">
                <ul class="px-4 py-4 space-y-1">
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>Home/Dashboard</a></li>
                    <li id="resource-management-menu" class="sidebar-item rounded-lg">
                        <button class="w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all-fast">
                            <span class="flex items-center"><i data-lucide="users-2" class="w-5 h-5 mr-3"></i>Resource Management</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform"></i>
                        </button>
                        <div class="sidebar-submenu-container">
                            <div class="sidebar-submenu pl-6 pr-2 pt-1 pb-2 space-y-1">
                                <a href="#" class="nav-link flex items-center py-2 px-4 text-sm rounded-lg transition-all-fast">Bench Management</a>
                                <a href="#" class="nav-link sub-active flex items-center py-2 px-4 text-sm rounded-lg">All Resources</a>
                                <a href="#" class="nav-link flex items-center py-2 px-4 text-sm rounded-lg transition-all-fast">Resource Directory</a>
                                <a href="#" class="nav-link flex items-center py-2 px-4 text-sm rounded-lg transition-all-fast">New Deployments</a>
                            </div>
                        </div>
                    </li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="trending-up" class="w-5 h-5 mr-3"></i>Demand & Opportunity</a></li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="award" class="w-5 h-5 mr-3"></i>Skills & Development</a></li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="pie-chart" class="w-5 h-5 mr-3"></i>Capacity Planning</a></li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="landmark" class="w-5 h-5 mr-3"></i>Cross Governance</a></li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="briefcase" class="w-5 h-5 mr-3"></i>External Workforce</a></li>
                    <li class="sidebar-item"><a href="#" class="nav-link flex items-center px-4 py-3 rounded-lg transition-all-fast"><i data-lucide="settings" class="w-5 h-5 mr-3"></i>Setup & Configuration</a></li>
                </ul>
            </div>
            <div class="p-4 border-t border-gray-700">
                 <a href="#" class="flex items-center p-3 rounded-lg hover:bg-gray-700/50 transition-all-fast">
                    <div class="w-10 h-10 rounded-full bg-brand-red text-white flex items-center justify-center font-bold">RM</div>
                    <div class="ml-3">
                        <p class="font-semibold text-white">Resource Manager</p>
                        <p class="text-xs text-gray-500">rm@workforce.io</p>
                    </div>
                 </a>
            </div>
        </nav>

        <div class="flex-1 flex flex-col">
            <header class="h-24 glassmorphic flex-shrink-0 flex items-center justify-between px-4 sm:px-8 z-10">
                <div class="flex items-center">
                    <button id="menu-btn" class="p-2 md:hidden mr-3"><i data-lucide="menu" class="w-6 h-6"></i></button>
                    <div>
                        <h2 id="page-title" class="text-xl sm:text-2xl font-bold text-brand-black">Resource Profile</h2>
                        <nav id="breadcrumb" aria-label="Breadcrumb" class="text-xs sm:text-sm text-gray-500 mt-1 hidden sm:block"></nav>
                    </div>
                </div>
                <div class="relative">
                    <button id="actions-menu-button" class="flex items-center justify-center h-11 px-3 sm:px-5 bg-brand-red text-white rounded-lg font-semibold hover:bg-red-700 transition-all-fast">
                        <i data-lucide="settings-2" class="w-5 h-5 sm:mr-2"></i><span class="hidden sm:inline">Actions</span>
                    </button>
                    <div id="actions-dropdown" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-20 ring-1 ring-black ring-opacity-5">
                        <div id="actions-list" class="py-1"></div>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-4 sm:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 space-y-8">
                        <div class="card p-6 relative overflow-hidden fade-in-card">
                            <div class="profile-card-bg absolute inset-0"></div>
                            <div class="relative flex flex-col sm:flex-row lg:flex-col items-center text-center sm:text-left lg:text-center">
                                <div id="profile-avatar" class="w-24 h-24 rounded-full flex-shrink-0 ring-4 ring-white shadow-md bg-brand-red text-white flex items-center justify-center text-4xl font-bold"></div>
                                <div class="mt-4 sm:mt-0 sm:ml-6 lg:ml-0 lg:mt-4">
                                    <div class="flex items-center justify-center sm:justify-start lg:justify-center flex-wrap gap-x-2">
                                        <h3 id="profile-name" class="text-2xl font-bold text-brand-black"></h3>
                                        <div id="profile-status-pill" class="mt-1 sm:mt-0"></div>
                                    </div>
                                    <p id="profile-job" class="text-gray-600"></p>
                                    <p id="profile-location" class="mt-2 text-sm text-gray-500 flex items-center justify-center sm:justify-start lg:justify-center"></p>
                                    <div id="looking-for-role-tag" class="hidden mt-4"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-6 fade-in-card" style="animation-delay: 100ms;">
                            <h4 class="font-bold text-lg mb-4">Key Details</h4>
                            <ul id="key-details-list" class="space-y-4"></ul>
                        </div>
                    </div>

                    <div class="lg:col-span-2 space-y-8">
                        <div class="card p-6 fade-in-card" style="animation-delay: 200ms;">
                            <h4 class="font-bold text-lg mb-4">Availability & Capacity</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-baseline">
                                    <span id="capacity-status-text" class="font-semibold text-lg"></span>
                                    <span id="total-allocation-percent" class="text-2xl font-bold">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden flex">
                                    <div id="hard-booked-bar" class="bg-green-500 h-full transition-all duration-500" style="width: 0%;"></div>
                                    <div id="soft-booked-bar" class="bg-yellow-500 h-full transition-all duration-500" style="width: 0%;"></div>
                                </div>
                                <div class="text-xs text-gray-500 grid grid-cols-3 gap-2">
                                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span><span id="hard-booked-summary">Hard: 0%</span></div>
                                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-yellow-500 mr-2"></span><span id="soft-booked-summary">Soft: 0%</span></div>
                                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-gray-200 mr-2"></span><span id="available-summary">Available: 0%</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6 fade-in-card" style="animation-delay: 300ms;">
                             <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-lg">Skills Profile</h4>
                                <div class="flex items-center space-x-2">
                                    <label for="skill-compare-role" class="text-sm">Compare to Role:</label>
                                    <select id="skill-compare-role" class="rounded-md border-gray-300 shadow-sm focus:border-brand-red focus:ring-brand-red sm:text-sm">
                                        <option value="">Select a role...</option>
                                    </select>
                                </div>
                            </div>
                            <div id="skills-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                            <div id="skill-gaps-container" class="mt-4 hidden">
                                <h5 class="font-bold text-md mb-2">Skill Gaps for this Role</h5>
                                <div id="skill-gaps-list" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                        <div class="card p-6 fade-in-card" style="animation-delay: 400ms;">
                             <h4 class="font-bold text-lg mb-4">Experience History</h4>
                            <div id="experience-history-list" class="relative pl-6 border-l-2 border-gray-200 space-y-8"></div>
                        </div>
                         <div class="card overflow-hidden fade-in-card" style="animation-delay: 500ms;">
                            <div class="p-6">
                                <h4 class="font-bold text-lg">Related Roles</h4>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Booking Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Role ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Project ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">BC ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Allocation</th>
                                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">End Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="related-roles-list" class="divide-y divide-gray-200"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        // --- MOCK DATA for this profile page ---
        const resourceProfile = {
            id: 27875,
            name: 'John Doe',
            location: 'Egypt',
            orgArea: 'Creative Services',
            jobProfile: 'Lead UI/UX Designer',
            level: 'L6',
            softBookCount: 1,
            email: 'john.doe@vodafone.com',
            phone: '+1-202-555-0104',
            skills: [
                { skill: 'Figma', level: 'Expert', date: '2023-10-15' },
                { skill: 'UI/UX', level: 'Advanced', date: '2023-08-20' },
                { skill: 'User Research', level: 'Advanced', date: '2022-11-01' },
                { skill: 'Design Systems', level: 'Expert', date: '2024-01-05' }
            ],
            status: 'Fully Utilized',
            utilizationPercent: 100,
            benchAging: null,
            avatar: 'JD',
            lookingForNewRole: true,
            locked: true,
            experience: [
                { role: 'Senior UI/UX Designer', project: 'Project Titan', duration: '2022 - 2024' },
                { role: 'UI/UX Designer', project: 'Project Apollo', duration: '2020 - 2022' },
                { role: 'Junior Designer', project: 'Internal Tools', duration: '2019 - 2020' }
            ],
            relatedRoles: [
                { type: 'Hard Booked', roleId: 'UX-001', projectId: 'PRJ-1124556', bcId: 'BC-123', allocation: 100, endDate: '2024-12-31' },
                { type: 'Soft Booked', roleId: 'UX-002', projectId: 'PRJ-9622400', bcId: 'BC-456', allocation: 0, endDate: '2025-10-20' },
            ]
        };
        
        const requiredSkillsForRoles = {
            'Senior Frontend Developer': [{ skill: 'React', level: 'Expert' }, { skill: 'JavaScript', level: 'Expert' }, { skill: 'Design Systems', level: 'Advanced' }],
            'Lead UI/UX Designer': [{ skill: 'Figma', level: 'Expert' }, { skill: 'User Research', level: 'Expert' }, { skill: 'Design Systems', level: 'Expert' }]
        };

        // --- RENDER FUNCTIONS ---
        const getStatusPill = (status, percent) => {
            let styles = '', text = status;
            switch (status) {
                case 'Fully Utilized': styles = 'bg-green-100/80 text-green-800'; break;
                case 'Partially Utilized': styles = 'bg-yellow-100/80 text-yellow-800'; text = `Utilized (${percent}%)`; break;
                case 'Available': styles = 'bg-blue-100/80 text-blue-800'; break;
                default: styles = 'bg-gray-100/80 text-gray-800';
            }
            return `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${styles}">${text}</span>`;
        };

        const getSkillTag = (level) => {
            let icon = 'circle';
            let color = 'bg-gray-200 text-gray-800';
            switch (level) {
                case 'Expert': icon = 'star'; color = 'bg-purple-200 text-purple-800'; break;
                case 'Advanced': icon = 'chevrons-up'; color = 'bg-sky-200 text-sky-800'; break;
            }
            return { icon, color };
        };

        const createDetailItem = (icon, label, value) => {
            return `<li class="flex items-start"><i data-lucide="${icon}" class="w-5 h-5 text-gray-400 mt-0.5"></i><div class="ml-3"><p class="font-medium text-gray-500 text-sm">${label}</p><p class="font-semibold">${value}</p></div></li>`;
        };

        // --- INITIALIZATION & EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            const pageTitle = document.getElementById('page-title');
            const breadcrumb = document.getElementById('breadcrumb');
            const profileAvatar = document.getElementById('profile-avatar');
            const profileName = document.getElementById('profile-name');
            const profileJob = document.getElementById('profile-job');
            const profileLocation = document.getElementById('profile-location');
            const profileStatusPill = document.getElementById('profile-status-pill');
            const keyDetailsList = document.getElementById('key-details-list');
            const skillsList = document.getElementById('skills-list');
            const experienceHistoryList = document.getElementById('experience-history-list');
            const relatedRolesList = document.getElementById('related-roles-list');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const menuBtn = document.getElementById('menu-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const actionsMenuButton = document.getElementById('actions-menu-button');
            const actionsDropdown = document.getElementById('actions-dropdown');
            const skillCompareRoleSelect = document.getElementById('skill-compare-role');
            const skillGapsContainer = document.getElementById('skill-gaps-container');
            const skillGapsList = document.getElementById('skill-gaps-list');
            const lookingForRoleTag = document.getElementById('looking-for-role-tag');

            const renderActions = (resource) => {
                const actions = [
                    { label: 'Edit Profile', icon: 'edit' },
                    { label: 'Export Profile', icon: 'download' },
                    { label: 'Soft Book Resource', icon: 'book-marked' },
                    { label: resource.lookingForNewRole ? 'Un-flag for new role' : 'Flag for new role', icon: 'flag', id: 'toggle-looking-for-role' },
                    { label: resource.locked ? 'Unlock Resource' : 'Lock Resource', icon: resource.locked ? 'unlock' : 'lock', id: 'toggle-lock-btn' },
                    { label: 'Move to Bench', icon: 'user-minus' }
                ];
                const actionsList = document.getElementById('actions-list');
                actionsList.innerHTML = actions.map(action => 
                    `<a href="#" id="${action.id || ''}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"><i data-lucide="${action.icon}" class="w-4 h-4 mr-3"></i>${action.label}</a>`
                ).join('');
                lucide.createIcons();
            };

            const renderCapacity = (roles) => {
                const hardBooked = roles.filter(r => r.type === 'Hard Booked').reduce((sum, r) => sum + r.allocation, 0);
                const softBooked = roles.filter(r => r.type === 'Soft Booked').reduce((sum, r) => sum + r.allocation, 0);
                const total = hardBooked + softBooked;
                const available = 100 - total;
                
                const totalAllocationPercent = document.getElementById('total-allocation-percent');
                const hardBookedBar = document.getElementById('hard-booked-bar');
                const softBookedBar = document.getElementById('soft-booked-bar');
                const hardBookedSummary = document.getElementById('hard-booked-summary');
                const softBookedSummary = document.getElementById('soft-booked-summary');
                const availableSummary = document.getElementById('available-summary');
                const capacityStatusText = document.getElementById('capacity-status-text');

                totalAllocationPercent.textContent = `${total}%`;
                hardBookedSummary.textContent = `Hard: ${hardBooked}%`;
                softBookedSummary.textContent = `Soft: ${softBooked}%`;
                availableSummary.textContent = `Available: ${Math.max(0, available)}%`;

                hardBookedBar.style.width = `${hardBooked}%`;
                softBookedBar.style.width = `${softBooked}%`;
                
                totalAllocationPercent.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600');
                capacityStatusText.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600');

                if (total > 100) {
                    capacityStatusText.textContent = "Overbooked";
                    capacityStatusText.classList.add('text-red-600');
                    totalAllocationPercent.classList.add('text-red-600');
                } else if (total === 100) {
                    capacityStatusText.textContent = "At Capacity";
                    capacityStatusText.classList.add('text-yellow-600');
                    totalAllocationPercent.classList.add('text-yellow-600');
                } else {
                    capacityStatusText.textContent = "Available Capacity";
                    capacityStatusText.classList.add('text-green-600');
                    totalAllocationPercent.classList.add('text-green-600');
                }
            };
            
            const renderSkills = (skills, compareRole = null) => {
                let requiredSkills = [];
                let missingSkills = [];
                if (compareRole && requiredSkillsForRoles[compareRole]) {
                    requiredSkills = requiredSkillsForRoles[compareRole];
                    const userSkillNames = skills.map(s => s.skill);
                    missingSkills = requiredSkills.filter(req => !userSkillNames.includes(req.skill));
                }

                skillsList.innerHTML = skills.map(skill => {
                    const tag = getSkillTag(skill.level);
                    let comparisonClass = '';
                    if (compareRole) {
                        const required = requiredSkills.find(r => r.skill === skill.skill);
                        if (required) {
                            comparisonClass = 'ring-2 ring-green-500';
                        }
                    }
                    return `<div class="p-4 rounded-lg bg-gray-50 flex-grow ${comparisonClass} transition-all-fast"><p class="font-bold">${skill.skill}</p><p class="text-sm ${tag.color} inline-flex items-center px-2 py-0.5 rounded-full mt-1"><i data-lucide="${tag.icon}" class="w-3 h-3 mr-1.5"></i>${skill.level}</p><p class="text-xs text-gray-400 mt-2">Verified: ${skill.date}</p></div>`
                }).join('');
                
                if (missingSkills.length > 0) {
                    skillGapsContainer.classList.remove('hidden');
                    skillGapsList.innerHTML = missingSkills.map(skill => 
                        `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">${skill.skill}</span>`
                    ).join('');
                } else {
                    skillGapsContainer.classList.add('hidden');
                }

                lucide.createIcons();
            };

            const populateProfile = (data) => {
                pageTitle.textContent = data.name;
                breadcrumb.innerHTML = `
                    <ol class="list-none p-0 inline-flex">
                        <li class="flex items-center"><a href="#" class="hover:text-brand-red">Home</a><i data-lucide="chevron-right" class="w-4 h-4 mx-1"></i></li>
                        <li class="flex items-center"><a href="#" class="hover:text-brand-red">All Resources</a><i data-lucide="chevron-right" class="w-4 h-4 mx-1"></i></li>
                        <li aria-current="page"><a href="#" class="text-brand-black font-medium">${data.name}</a></li>
                    </ol>`;

                profileAvatar.textContent = data.avatar;
                profileName.innerHTML = `${data.name} ${data.locked ? '<i data-lucide="lock" class="inline-block w-5 h-5 text-gray-400 ml-2"></i>' : ''}`;
                profileJob.textContent = data.jobProfile;
                profileLocation.innerHTML = `<i data-lucide="map-pin" class="w-4 h-4 mr-1"></i> ${data.location}`;
                profileStatusPill.innerHTML = getStatusPill(data.status, data.utilizationPercent);

                if (data.lookingForNewRole) {
                    lookingForRoleTag.innerHTML = `<span class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><i data-lucide="search" class="w-3 h-3"></i>Looking for new role</span>`;
                    lookingForRoleTag.classList.remove('hidden');
                } else {
                    lookingForRoleTag.classList.add('hidden');
                }

                keyDetailsList.innerHTML = 
                    createDetailItem('hash', 'Resource ID', data.id) +
                    createDetailItem('briefcase', 'Organization Area', data.orgArea) +
                    createDetailItem('bar-chart-2', 'Level', data.level) +
                    createDetailItem('clock', 'Bench Aging', data.benchAging !== null ? `${data.benchAging} days` : 'N/A') +
                    createDetailItem('mail', 'Email', `<a href="mailto:${data.email}" class="text-brand-red hover:underline">${data.email}</a>`) +
                    createDetailItem('phone', 'Phone', data.phone);

                Object.keys(requiredSkillsForRoles).forEach(roleName => {
                    const option = document.createElement('option');
                    option.value = roleName;
                    option.textContent = roleName;
                    skillCompareRoleSelect.appendChild(option);
                });
                renderSkills(data.skills);

                experienceHistoryList.innerHTML = data.experience.map(exp => 
                    `<div class="relative"><div class="absolute -left-[33px] top-1.5 w-4 h-4 bg-gray-300 rounded-full border-4 border-white"></div><h5 class="font-bold">${exp.role}</h5><p class="text-sm text-gray-600">${exp.project}</p><p class="text-xs text-gray-400 mt-1">${exp.duration}</p></div>`
                ).join('');

                relatedRolesList.innerHTML = data.relatedRoles.map(role => {
                    let typeClass = '';
                    switch(role.type) {
                        case 'Soft Booked': typeClass = 'bg-yellow-100 text-yellow-800'; break;
                        case 'Hard Booked': typeClass = 'bg-green-100 text-green-800'; break;
                        case 'Proposed': typeClass = 'bg-blue-100 text-blue-800'; break;
                    }
                    return `<tr>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 text-xs font-medium rounded-full ${typeClass}">${role.type}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold"><a href="#" class="text-brand-red hover:underline">${role.roleId}</a></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${role.projectId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${role.bcId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${role.allocation}%</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${role.endDate}</td>
                    </tr>`
                }).join('');

                renderCapacity(data.relatedRoles);
                renderActions(data);
                lucide.createIcons();
            };

            populateProfile(resourceProfile);
            
            const toggleSidebar = () => {
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('open');
            };

            menuBtn.addEventListener('click', toggleSidebar);
            closeSidebarBtn.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            
            const resManMenu = document.getElementById('resource-management-menu');
            resManMenu.addEventListener('click', function(e) {
                const submenuContainer = this.querySelector('.sidebar-submenu-container');
                const icon = this.querySelector('[data-lucide="chevron-down"]');
                submenuContainer.classList.toggle('open');
                icon.classList.toggle('rotate-180');
            });
            
            const activeSubmenuLink = document.querySelector('.nav-link.sub-active');
            if (activeSubmenuLink) {
                const parentMenu = activeSubmenuLink.closest('.sidebar-item');
                if (parentMenu) {
                    parentMenu.classList.add('parent-active');
                    parentMenu.querySelector('button').click();
                }
            }

            actionsMenuButton.addEventListener('click', () => {
                actionsDropdown.classList.toggle('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (!actionsMenuButton.contains(e.target) && !actionsDropdown.contains(e.target)) {
                    actionsDropdown.classList.add('hidden');
                }

                const toggleFlagBtn = e.target.closest('#toggle-looking-for-role');
                if (toggleFlagBtn) {
                    resourceProfile.lookingForNewRole = !resourceProfile.lookingForNewRole;
                    populateProfile(resourceProfile);
                }

                const toggleLockBtn = e.target.closest('#toggle-lock-btn');
                if (toggleLockBtn) {
                    resourceProfile.locked = !resourceProfile.locked;
                    populateProfile(resourceProfile);
                }
            });

            skillCompareRoleSelect.addEventListener('change', (e) => {
                renderSkills(resourceProfile.skills, e.target.value);
            });
        });
    </script>
</body>
</html>
